DROP PROCEDURE if exists remcon.pCalculateAllSalary;

DELIMITER $$

/************************/
CREATE PROCEDURE remcon.pCalculateAllSalary()
BEGIN
	DECLARE vId, vPeriod BIGINT DEFAULT 0;
	DECLARE vDone BOOLEAN DEFAULT FALSE;
/*
	DECLARE vAmount, vUF, vSum DOUBLE DEFAULT 0;
	DECLARE vKey VARCHAR(3) DEFAULT '   ';
	*/
	DECLARE cursorEmployee CURSOR FOR
		SELECT	cId
		FROM	remcon.tEmployee;
	DECLARE CONTINUE HANDLER FOR NOT FOUND SET vDone = TRUE;
	
	SET vPeriod = remcon.fGetOpenedPeriod();
	
	OPEN cursorEmployee;
	cursorEmployee_loop: LOOP
		FETCH cursorEmployee INTO vId;
		
		IF(vDone) THEN 
			LEAVE cursorEmployee_loop;
		END IF;

/*
select concat('Procesando: Employee:', vId, ' - Period:', vPeriod);
*/
	    CALL pCalculateSalary(vId, vPeriod);
		
	END LOOP cursorEmployee_loop;
	CLOSE cursorEmployee;
			
END $$

DELIMITER ;

