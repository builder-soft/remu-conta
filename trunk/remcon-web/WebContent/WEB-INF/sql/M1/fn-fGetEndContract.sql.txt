DROP FUNCTION IF EXISTS fGetEndContract;

DELIMITER $$

CREATE FUNCTION fGetEndContract(vEmployee BIGINT) RETURNS DATE
BEGIN
	DECLARE	vOut DATE;
	
	SELECT	CASE cContractType
			WHEN 1 THEN NOW()
			ELSE cEndContract END
	INTO	vOut
	FROM	tEmployee AS a
	LEFT JOIN tAgreement AS b ON b.cEmployee = a.cId
	WHERE	a.cId = vEmployee;
	
	RETURN vOut;
END$$

DELIMITER ;